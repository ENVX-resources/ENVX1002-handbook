<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.42">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>nonparametric1 – ENVX1002 Handbook</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-1fa1d8026083a9bddc52b4aafc7f818e.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-dark-8e00f2f28a1266a720913de837032221.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap-2b359d2b6993200113079de798898405.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../site_libs/bootstrap/bootstrap-dark-21abdccd215aee3adb44e4f991220b7f.min.css" rel="prefetch" append-hash="true" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="../styles.css">
</head>

<body class="nav-sidebar docked nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">ENVX1002 Handbook</span>
    </a>
  </div>
        <div class="quarto-navbar-tools tools-end">
    <a href="../#" title="Source Code" class="quarto-navigation-tool px-1" aria-label="Source Code"><i class="bi bi-github"></i></a>
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
          <div id="quarto-search" class="" title="Search"></div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../module02/01-ttest1.html"><strong>📗 Module 2</strong></a></li><li class="breadcrumb-item"><a href="../module02/03-nonparametric1.html">Chi-squared tests</a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation docked overflow-auto">
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../000-rguide.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">A brief R guide for surviving ENVX1002</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../001-intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Introduction to statistics</span></a>
  </div>
</li>
        <li class="px-0"><hr class="sidebar-divider hi "></li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text"><strong>📕 Module 1</strong></span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../module01/01-intro_statistical_programming.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Introduction to Statistical Programming</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true">
 <span class="menu-text"><strong>📗 Module 2</strong></span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../module02/01-ttest1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">One-sample <span class="math inline">\(t\)</span>-test</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../module02/02-ttest2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Two-sample <span class="math inline">\(t\)</span>-test</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../module02/03-nonparametric1.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Chi-squared tests</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true">
 <span class="menu-text"><strong>📘 Module 3</strong></span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../module03/040-describing_relationships.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Describing relationships</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../module03/041-linear_functions.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Why do we create models?</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../module03/042-linear_functions_multi.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Multiple Linear Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../module03/043-nonlinear.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Non-linear regression</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="px-0"><hr class="sidebar-divider hi "></li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true">
 <span class="menu-text"><strong>🖥️ Computer labs</strong></span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../labs/Lab01.html" class="sidebar-item-text sidebar-link" target="_blank">
 <span class="menu-text">Lab 01 – Getting started</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../labs/Lab02.html" class="sidebar-item-text sidebar-link" target="_blank">
 <span class="menu-text">Lab 02 – Statistical programming</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../labs/Lab03.html" class="sidebar-item-text sidebar-link" target="_blank">
 <span class="menu-text">Lab 03 – Exploring and visualising data</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../labs/Lab04.html" class="sidebar-item-text sidebar-link" target="_blank">
 <span class="menu-text">Lab 04 – Central limit theorem</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../labs/Lab05.html" class="sidebar-item-text sidebar-link" target="_blank">
 <span class="menu-text">Lab 05 – Hypothesis testing</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../labs/Lab06.html" class="sidebar-item-text sidebar-link" target="_blank">
 <span class="menu-text">Lab 06 – Two-sample <em>t</em>-test</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../labs/Lab07.html" class="sidebar-item-text sidebar-link" target="_blank">
 <span class="menu-text">Lab 07 – Chi-squared test</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../labs/Lab08.html" class="sidebar-item-text sidebar-link" target="_blank">
 <span class="menu-text">Lab 08 – 🚫 No exercises</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../labs/Lab09.html" class="sidebar-item-text sidebar-link" target="_blank">
 <span class="menu-text">Lab 9 – Describing relationships</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../labs/Lab10.html" class="sidebar-item-text sidebar-link" target="_blank">
 <span class="menu-text">Lab 10 – Linear functions</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../labs/Lab11.html" class="sidebar-item-text sidebar-link" target="_blank">
 <span class="menu-text">Lab 11 - Multiple Linear Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../labs/Lab12.html" class="sidebar-item-text sidebar-link" target="_blank">
 <span class="menu-text">Lab 12 - Non-linear models</span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#chi-squared-tests" id="toc-chi-squared-tests" class="nav-link active" data-scroll-target="#chi-squared-tests">Chi-squared tests</a>
  <ul class="collapse">
  <li><a href="#notes-on-the-chi2-distribution" id="toc-notes-on-the-chi2-distribution" class="nav-link" data-scroll-target="#notes-on-the-chi2-distribution">Notes on the <span class="math inline">\(\chi^2\)</span> Distribution</a></li>
  <li><a href="#testing-agreement-of-frequency-data-with-expectation-models" id="toc-testing-agreement-of-frequency-data-with-expectation-models" class="nav-link" data-scroll-target="#testing-agreement-of-frequency-data-with-expectation-models">Testing Agreement of Frequency Data with Expectation Models</a>
  <ul class="collapse">
  <li><a href="#steps-in-chi-squared-tests-of-agreement" id="toc-steps-in-chi-squared-tests-of-agreement" class="nav-link" data-scroll-target="#steps-in-chi-squared-tests-of-agreement">Steps in Chi-Squared Tests of Agreement</a></li>
  <li><a href="#examples-testing-whether-outcomes-are-equally-probable" id="toc-examples-testing-whether-outcomes-are-equally-probable" class="nav-link" data-scroll-target="#examples-testing-whether-outcomes-are-equally-probable">Examples: Testing Whether Outcomes are Equally Probable</a></li>
  <li><a href="#example-testing-whether-outcomes-are-in-expected-proportions" id="toc-example-testing-whether-outcomes-are-in-expected-proportions" class="nav-link" data-scroll-target="#example-testing-whether-outcomes-are-in-expected-proportions">Example: Testing Whether Outcomes are in Expected Proportions</a></li>
  </ul></li>
  <li><a href="#contingency-tables" id="toc-contingency-tables" class="nav-link" data-scroll-target="#contingency-tables">Contingency Tables</a>
  <ul class="collapse">
  <li><a href="#example-2-x-2-contingency-table" id="toc-example-2-x-2-contingency-table" class="nav-link" data-scroll-target="#example-2-x-2-contingency-table">Example: (2 x 2) Contingency Table</a></li>
  <li><a href="#example-4-x-3-contingency-table" id="toc-example-4-x-3-contingency-table" class="nav-link" data-scroll-target="#example-4-x-3-contingency-table">Example: (4 x 3) Contingency Table</a></li>
  </ul></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content"><header id="title-block-header" class="quarto-title-block"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../module02/01-ttest1.html"><strong>📗 Module 2</strong></a></li><li class="breadcrumb-item"><a href="../module02/03-nonparametric1.html">Chi-squared tests</a></li></ol></nav></header>




<section id="chi-squared-tests" class="level1">
<h1>Chi-squared tests</h1>
<p>The chi-squared distribution (where chi is pronounced ‘ky’) is a very widely used distribution in statistics. Its symbol is <span class="math inline">\(\chi^2\)</span>. It has MANY applications. Here we will consider only two of these applications – tests of agreement with expected outcomes, and contingency tables.</p>
<section id="notes-on-the-chi2-distribution" class="level2">
<h2 class="anchored" data-anchor-id="notes-on-the-chi2-distribution">Notes on the <span class="math inline">\(\chi^2\)</span> Distribution</h2>
<p>The density function for a <span class="math inline">\(\chi^2\)</span> distribution is positively skewed, that is, it has a long tail to the right. The typical shape of the <span class="math inline">\(\chi^2\)</span> density function is that shown for the 4 df case in Figure 7.1 below. When df is very low e.g.&nbsp;1 or 2, the curve changes shape dramatically. When df are very large (say greater than 100), the <span class="math inline">\(\chi^2\)</span> distribution approaches the shape (and properties) of a normal distribution.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/chisquare_density_function.png" class="img-fluid figure-img"></p>
<figcaption>Figure 7.1 The shape of the <span class="math inline">\(\chi^2\)</span> density function for various degrees of freedom.</figcaption>
</figure>
</div>
<p>The mean and variance of a <span class="math inline">\(\chi^2\)</span> variable are simple functions of the degrees of freedom of the distribution. If we express the general degrees of freedom as <span class="math inline">\(\nu\)</span> (Greek n), then</p>
<ul>
<li>Mean of <span class="math inline">\(\chi^2\)</span> variable = <span class="math inline">\(\nu\)</span> (i.e.&nbsp;mean = df)</li>
<li>Variance of <span class="math inline">\(\chi^2\)</span> variable = <span class="math inline">\(2\nu\)</span> (i.e.&nbsp;variance = twice the df)</li>
</ul>
<p>Critical values of a <span class="math inline">\(\chi^2\)</span> distribution are given in the <span class="math inline">\(\chi^2\)</span> probability table that appears as Appendix A.5.</p>
</section>
<section id="testing-agreement-of-frequency-data-with-expectation-models" class="level2">
<h2 class="anchored" data-anchor-id="testing-agreement-of-frequency-data-with-expectation-models">Testing Agreement of Frequency Data with Expectation Models</h2>
<section id="steps-in-chi-squared-tests-of-agreement" class="level3">
<h3 class="anchored" data-anchor-id="steps-in-chi-squared-tests-of-agreement">Steps in Chi-Squared Tests of Agreement</h3>
<p>The process for performing a goodness of fit test is the similar to that of the other hypothesis tests you have encountered thus far, that is,</p>
<ol type="1">
<li><p>Choose an appropriate hypothesis test for the type of data you have, and the type of question you’re asking.</p></li>
<li><p>Choose the level of significance for the test.</p></li>
<li><p>Write null and alternate hypotheses. Here (as for normality tests) the null hypothesis is always that the data can be assumed to follow the distribution under consideration.</p></li>
<li><p>Calculate the expected values. To do this, we assume that the null hypothesis is true and generate the expected values accordingly</p></li>
<li><p>Check the assumptions or requirements of the test. For observed versus expected chi square goodness of fit tests, the requirements of the test are that a) no cell should have an expected value of less than 1 and b) no more than 20% of cells should have expected values less than 5. To overcome either of these problems, we tend to collapse cells together before calculating the test statistic – however there are alternative tests designed to accommodate these situations.</p></li>
<li><p>Calculate the test statistic and degrees of freedom.</p></li>
<li><p>Obtain the P-value.</p></li>
<li><p>Draw a statistical conclusion, and use this to generate a biological conclusion.</p></li>
</ol>
</section>
<section id="examples-testing-whether-outcomes-are-equally-probable" class="level3">
<h3 class="anchored" data-anchor-id="examples-testing-whether-outcomes-are-equally-probable">Examples: Testing Whether Outcomes are Equally Probable</h3>
<p><em>EXAMPLE 1</em></p>
<p>Sometimes the simplest form of hypothesis is that different outcomes are equally probable. For example, we expect that when a “fair” coin is tossed that the heads and tails outcomes are equally probable. However, we would see different results if the coin is biased and we can conduct a formal hypothesis test to see whether the outcomes are deviating significantly from our expectation of a “fair” coin.</p>
<p><em>EXAMPLE 2</em> (from Mead et al, 2003)</p>
<p>Suppose that 40 testers were asked to compare four different cheeses produced by different procedures and identified only by the letters A, B, C, D. Assume that each tester makes one choice and the preferences were as follows.</p>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Cheese</th>
<th>First preference</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>A</td>
<td>5</td>
</tr>
<tr class="even">
<td>B</td>
<td>7</td>
</tr>
<tr class="odd">
<td>C</td>
<td>18</td>
</tr>
<tr class="even">
<td>D</td>
<td>10</td>
</tr>
<tr class="odd">
<td>Total</td>
<td>40</td>
</tr>
</tbody>
</table>
<p>We might suspect that this shows an overall preference for C. To test the simple model that testers are equally likely to prefer A, B, C, or D, we would calculate the expected frequency for each cheese to be preferred as the total number of testers divided by 4 = 40/4 = 10. Then we calculate:</p>
<p><span class="math display">\[\chi^2_{obs}=\frac{(5-10)^2}{10}+ \frac{(7-10)^2}{10}+ \frac{(10-10)^2}{10}  =9.80\]</span></p>
<p>This time we have four frequencies with one overall restriction that they total 40, and so there are 3 df. The 5% point of the <span class="math inline">\(\chi^2\)</span> distribution on 3df is 7.82, so the unevenness of the preferences is significant (given that the <span class="math inline">\(\chi^2_{obs}\)</span> value of 9.80 is greater than the <span class="math inline">\(\chi^2_{crit}\)</span> value of 7.82. The evidence suggests that the model of equally likely choices is incorrect. [Equivalently, we could produce a chi-squared probability via =CHISQ.DIST.RT(9.80,3) in Excel which returns P = 0.0203. We reject H<sub>0</sub> since <span class="math inline">\(P &lt; 0.05\)</span>)</p>
<p>To assess the extent to which it is the preference for cheese C that contradicts the model, we might decide to do a further test to compare whether the preference for C only is different to the preference for all the other cheeses. In a model of likely choices, our expected values are C = 10 and all other = 30. We observed C = 18, and all other = 22. You can proceed with the test as per above starting with</p>
<p><span class="math display">\[ \chi^2_{obs}=\frac{(18-10)^2}{10}+ \frac{(22-30)^2}{30}  =…\text{etc.}\]</span></p>
</section>
<section id="example-testing-whether-outcomes-are-in-expected-proportions" class="level3">
<h3 class="anchored" data-anchor-id="example-testing-whether-outcomes-are-in-expected-proportions">Example: Testing Whether Outcomes are in Expected Proportions</h3>
<p>(from Mead et al, 2003)</p>
<p>A total of 560 primula plants were classified by the type of leaf (flat or crimped) and the type of eye (normal or Primrose Queen).</p>
<p>The figures obtained for the primula plants follow.</p>
<table class="caption-top table">
<thead>
<tr class="header">
<th></th>
<th>Normal eye</th>
<th>Primrose Queen eye</th>
<th>Total</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Flat leaves</td>
<td>328</td>
<td>122</td>
<td>450</td>
</tr>
<tr class="even">
<td>Crimped leaves</td>
<td>77</td>
<td>33</td>
<td>110</td>
</tr>
<tr class="odd">
<td>Total</td>
<td>405</td>
<td>115</td>
<td>560</td>
</tr>
</tbody>
</table>
<p>On the hypothesis of a Mendelian 3:1 ratio, we would expect, for each characteristic, 3/4 of the total 560 observation in the first class of the characteristic and the remaining 1/4 in the second class. Further, this model predicts that 3/4 of the flat-leaved plants should have normal eyes, resulting in 3/4 <span class="math inline">\(\times\)</span> 3/4 of all the plants or 9/16 with flat leaves and normal eyes; the remaining 3/4 of the flat-leaved plants, which is 1/4 <span class="math inline">\(\times\)</span> 3/4or 3/16, should have Primrose Queen eyes. Similarly, 3/16 of the plants should have crimped leaves and normal eyes; and 1/16 crimped leaves and Primrose Queen eyes.</p>
<p>The calculation of these expected or predicted proportions is shown below.</p>
<table class="caption-top table">
<thead>
<tr class="header">
<th></th>
<th>Normal eye</th>
<th>Primrose Queen eye</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Flat leaves</td>
<td>3/4 x 3/4 = 9/16</td>
<td>1/4 x 3/4 = 3/16</td>
</tr>
<tr class="even">
<td>Crimped leaves</td>
<td>3/4 x 1/4 = 3/16</td>
<td>1/4 x 1/4 = 1/16</td>
</tr>
</tbody>
</table>
<p>Hence, the hypothesis predicts ratios of 9:3:3:1 for the four classes (flat normal: flat Primrose Queen: crimped normal: crimped Primrose Queen). The expected frequencies are calculated as 9/16, 3/16, 3/16, and 1/16 of 560, producing 315, 105, 105, and 35.</p>
<p>The observed and expected frequencies are summarized in the table below.</p>
<table class="caption-top table">
<thead>
<tr class="header">
<th></th>
<th>Normal eye</th>
<th>Primrose Queen eye</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Flat leaves</td>
<td>328 (315)</td>
<td>122 (105)</td>
</tr>
<tr class="even">
<td>Crimped leaves</td>
<td>77 (105)</td>
<td>33 (35)</td>
</tr>
</tbody>
</table>
<p><span class="math display">\[
\begin{split}
\chi^2_{obs} &amp;= \frac{(328-315)^2}{315}+ \frac{(122+105)^2}{105}+ \frac{(77-105)^2}{105}+ \frac{(33-35)^2}{35}  \\
&amp;= 0.54 + 2.75 + 7.47 + 0.11 \\
&amp;= 10.77.
\end{split}
\]</span> We compare 10.77 with the 5% point of the <span class="math inline">\(\chi^2\)</span> distribution on 3df (7.82). We conclude that the 9:3:3:1 model is not acceptable.</p>
<p>See pp.&nbsp;332-333 of Mead et al, 2003 for what to do next… after rejecting the model.</p>
</section>
</section>
<section id="contingency-tables" class="level2">
<h2 class="anchored" data-anchor-id="contingency-tables">Contingency Tables</h2>
<section id="example-2-x-2-contingency-table" class="level3">
<h3 class="anchored" data-anchor-id="example-2-x-2-contingency-table">Example: (2 x 2) Contingency Table</h3>
<p>Consider an experiment in which two surgical procedures are to be compared by observing the recovery rates of animals receiving either Procedure 1 or Procedure 2. Twenty animals were randomly allocated to receive Procedure 1 and twenty animals to receive Procedure 2.</p>
<table class="table-striped table-hover caption-top table">
<caption>Recovered</caption>
<thead>
<tr class="header">
<th></th>
<th>Yes</th>
<th>No</th>
<th>Total</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Procedure 1</td>
<td>2.05</td>
<td>6</td>
<td>20</td>
</tr>
<tr class="even">
<td>Procedure 2</td>
<td>1.37</td>
<td>12</td>
<td>20</td>
</tr>
<tr class="odd">
<td>Total</td>
<td>20</td>
<td>18</td>
<td>40</td>
</tr>
</tbody>
</table>
<p>This is one form of a 2x2 contingency table, since there are two rows and two columns (ignoring the totals). It appears that Procedure 1 leads to a higher recovery rate. Is this due to chance?</p>
<p>Solution: We will perform a statistical hypothesis test:</p>
<p>H<sub>0</sub>: There is no difference in the true recovery rates for animals on either procedure.</p>
<p>H<sub>1</sub>: The recovery rates do differ.</p>
<p>In terms of parameters, let p<sub>1</sub> be the probability that an animal recovers under Procedure 1, and p<sub>2</sub> the probability that an animal recovers under Procedure 2. Then the hypotheses are equivalent to</p>
<p><span class="math display">\[       
H_0: p_1 = p_2
H_1: p_1 \neq p_2
\]</span></p>
<p>Estimates of individual recovery rates are <span class="math inline">\(\hat p = 14/20 = 0.7\)</span> and <span class="math inline">\(\hat p = 8/20 = 0.4\)</span>. Is this difference due to chance?</p>
<p>If H<sub>0</sub> is true, there is a common recovery rate (which we label p). Assuming H<sub>0</sub> is true, the best estimate of p is</p>
<p><span class="math display">\[
\hat p = \frac{14 +8}{20+20}= \frac{22}{40}=0.55
\]</span></p>
<p>So the expected frequency (under H<sub>0</sub>) of recoveries for Procedure 1 would be $20 /40 = 20 = 11 $ animals. In general this can be written as: <span class="math display">\[
\text{Expected Frequency} = \frac{( \text{row total})\times (\text{Column total})}{\text{Grand Total}}
\]</span> So the expected frequencies for the cells in the table are: <span class="math display">\[
\begin{split}
\text{Procedure 1, Recovered:}\ \frac{20 \times 22}{40} &amp;= 11\\
\text{Procedure 1, Not recovered:}\ \frac{20 \times 18}{40} &amp;=9 \\
\text{Procedure 2, Recovered:}\ \frac{20 \times 22}{40} &amp;= 11\\
\text{Procedure 2, Not recovered:}\ \frac{20 \times 18}{40} &amp;=9
\end{split}
\]</span> Expected frequencies are written on the contingency table in parentheses, allowing comparisons with observed frequencies:</p>
<table class="table-striped table-hover caption-top table">
<caption>Recovered</caption>
<thead>
<tr class="header">
<th></th>
<th>Yes</th>
<th>No</th>
<th>Total</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Procedure 1</td>
<td>14 (11)</td>
<td>6 (9)</td>
<td>20</td>
</tr>
<tr class="even">
<td>Procedure 2</td>
<td>8 (11)</td>
<td>12 (9)</td>
<td>20</td>
</tr>
<tr class="odd">
<td>Total</td>
<td>20</td>
<td>18</td>
<td>40</td>
</tr>
</tbody>
</table>
<p>The table shows observed (and expected) frequencies. The <span class="math inline">\(\chi^2\)</span> test statistic is then calculated using: <span class="math display">\[
\begin{split}
\chi^2 &amp;=\sum \frac{\text{(Observed - expected)}^2}{\text{Expected}}\\
&amp;=\frac{(14-11)^2}{11}+\frac{(6-9)^2}{9}+ \frac{(8-11)^2}{11}+\frac{(12-9)^2}{9}\\
&amp;= 3.64
\end{split}
\]</span> Large values of <span class="math inline">\(\chi^2\)</span> indicate discrepancies between observed and expected frequencies, i.e.&nbsp;large values indicate that H<sub>0</sub> should be rejected in favour of H<sub>1</sub>.</p>
<p>The df of this <span class="math inline">\(\chi^2\)</span> test is 1 for a <span class="math inline">\(2 \times 2\)</span> contingency table. In general, &gt;df = (number of rows - 1) x (number of columns - 1)</p>
<p>If H<sub>0</sub> is true, the observed <span class="math inline">\(\chi^2\)</span> is just one observation from a <span class="math inline">\(\chi^2\)</span> distribution with 1 df:</p>
<p>Since <span class="math inline">\(P =P(\chi^2_1&gt;3.64)=0.056\)</span>, there is (just) not sufficient evidence to reject H<sub>0</sub>. Thus, while Procedure 1 has a higher recovery rate, it just fails to reach statistical significance. At this stage, the difference in individual recovery rates appears to be chance. Increasing the numbers of animals in a new experiment will determine the question with higher precision.</p>
</section>
<section id="example-4-x-3-contingency-table" class="level3">
<h3 class="anchored" data-anchor-id="example-4-x-3-contingency-table">Example: (4 x 3) Contingency Table</h3>
<p>The second example is a 43 contingency table. Three vaccines for a disease were compared with a control. The number of animals with no, mild, and severe infection was recorded after 24 months. Data were recorded in the following table:</p>
<table class="table-striped table-hover caption-top table">
<caption>Disease Status</caption>
<thead>
<tr class="header">
<th>Vaccine</th>
<th>No</th>
<th>Mild</th>
<th>Severe</th>
<th>Total</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Control</td>
<td>100 (137.3)</td>
<td>71 (42.6)</td>
<td>29 (20.1)</td>
<td>200</td>
</tr>
<tr class="even">
<td>A</td>
<td>146 (133.9)</td>
<td>32 (41.6)</td>
<td>17 (19.6)</td>
<td>195</td>
</tr>
<tr class="odd">
<td>B</td>
<td>149 (132.5)</td>
<td>28 (41.2)</td>
<td>16 (19.3)</td>
<td>193</td>
</tr>
<tr class="even">
<td>C</td>
<td>146 (137.3)</td>
<td>37 (42.6)</td>
<td>17 (20.1)</td>
<td>200</td>
</tr>
<tr class="odd">
<td>Total</td>
<td>541</td>
<td>168</td>
<td>79</td>
<td>788</td>
</tr>
</tbody>
</table>
<p>The table shows observed (and expected) frequencies.</p>
<p>We test H<sub>0</sub> that there is no association between disease status and vaccination given, i.e.&nbsp;all vaccinations have equal effectiveness.</p>
<p>Assuming H<sub>0</sub> is true, the expected frequencies are calculated as follows:</p>
<p>e.g.&nbsp;Expected frequency for an animal in the <em>Control, No</em> disease group: <span class="math display">\[
\frac{\text{row total}\times \text{column total}}{\text{grand total}}
= \frac{200 \times 541}{788} =137.3
\]</span></p>
<p>As before, the test statistic is $^2 = $ and this will have (4-1)<span class="math inline">\(\times\)</span>(3-1) = 6 df.</p>
<p>Pearson chi-squared value is 45.22 with 6 df.</p>
<p>Probability level (under null hypothesis) p &lt; 0.001</p>
<p>The other available method is known as the maximum likelihood (ML) method. The two answers are usually very similar:</p>
<p>Likelihood chi-squared value is 43.34 with 6 df.</p>
<p>Probability level (under null hypothesis) p &lt; 0.001</p>
<p>The ML <span class="math inline">\(\chi^2\)</span> is calculated as follows: <span class="math display">\[
\chi^2=2\sum Observed \times ln(\frac{Observed}{Expected} )
\]</span></p>
<p>The degrees of freedom are (r – 1)(c – 1) as before, where r and c are the numbers of rows and columns respectively.</p>
<p>In general, the <span class="math inline">\(\chi^2\)</span> approximation should only be used if the sample size is relatively large. As a general rule, there should be few expected frequencies below 5 and none below 1.0. Most packages will print out a warning when this occurs. Some situations allow exact probabilities to be calculated, but we will not pursue that in this course.</p>
<p>An example of low numbers would be the following, (these are basically 1/10th the numbers in the previous example):</p>
<table class="table-striped table-hover caption-top table">
<caption>Disease Status</caption>
<thead>
<tr class="header">
<th>Vaccine</th>
<th>No</th>
<th>Mild</th>
<th>Severe</th>
<th>Total</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Control</td>
<td>10</td>
<td>7</td>
<td>3</td>
<td>20</td>
</tr>
<tr class="even">
<td>A</td>
<td>15</td>
<td>3</td>
<td>2</td>
<td>20</td>
</tr>
<tr class="odd">
<td>B</td>
<td>15</td>
<td>3</td>
<td>2</td>
<td>20</td>
</tr>
<tr class="even">
<td>C</td>
<td>15</td>
<td>4</td>
<td>2</td>
<td>21</td>
</tr>
<tr class="odd">
<td>Total</td>
<td>55</td>
<td>17</td>
<td>9</td>
<td>81</td>
</tr>
</tbody>
</table>


</section>
</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
    const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
    const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
    let newTheme = '';
    if(darkModeDefault) {
      newTheme = isAlternate ? baseTheme : alternateTheme;
    } else {
      newTheme = isAlternate ? alternateTheme : baseTheme;
    }
    const changeGiscusTheme = () => {
      // From: https://github.com/giscus/giscus/issues/336
      const sendMessage = (message) => {
        const iframe = document.querySelector('iframe.giscus-frame');
        if (!iframe) return;
        iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
      }
      sendMessage({
        setConfig: {
          theme: newTheme
        }
      });
    }
    const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
    if (isGiscussLoaded) {
      changeGiscusTheme();
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  const darkModeDefault = false;
  let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
    toggleGiscusIfUsed(toAlternate, darkModeDefault);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/ENVX-resources\.github\.io\/ENVX1002-handbook\/");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>