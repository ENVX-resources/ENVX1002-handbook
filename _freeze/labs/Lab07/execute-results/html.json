{
  "hash": "d21db99cc06cae46f7e2d21e1e0bf428",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: Lab 07 -- Chi-squared test\nembed-resources: true\n---\n\n\n\n\n\n\n::: callout-tip\n## Learning Outcomes\n\n- Learn to use R to calculate a chi-squared test for:\n  - Test of proportions\n  - Test of independence\n- Learn how to interpret statistical output.\n:::\n\n## Before we begin\n\nCreate your Quarto document and save it as `Lab-07.qmd` or similar. There are no data files to download for this lab.\n\n\n## Quick introduction\nThe chi-square test is used to compare the *observed* distribution to an *expected* distribution, in a situation where we have **two or more categories** in a discrete data. In other words, it compares multiple observed proportions to expected probabilities.\n\nThe formula is:\n\n$$\\chi^2 = \\sum_{i=1}^{k}\\frac{(O_i - E_i)^2}{E_i}$$\n\nwhere $O_i$ is the observed frequency, $E_i$ is the expected frequency for each categorym and $k$ is the number of categories.\n\nFor more information about the technique, consult your lecture slides and tutorial 7.\n\n## Exercise 1: wild tulips (walk-through)\n\n\n### Background\n\nSuppose we collected wild tulips and found that 81 were red, 50 were yellow and 27 were white. Are these colours equally common?\n\n**If these colours were equally distributed, the expected proportion would be 1/3 for each of the colour.** Therefore, we want to test if the observed proportions are significantly different from the expected proportions.\n\nThe data is below.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntulip <- c(81, 50, 27)\n```\n:::\n\n\n\n\n### Instructions\nUtilise the **HATPC** process and test the hypothesis that the proportion of flower colours of tulips are equally common, assuming that the samples are independent. We can explore the data as we check the assumptions of the test.\n\n::: column-margin\nHATPC:\n\n- Hypothesis\n- Assumptions\n- Test (statistic)\n- P-value\n- Conclusion\n:::\n\n::: callout-note\n## Level of significance\n**The level of significance is usually set at 0.05.** This value is generally accepted in the scientific community and is also linked to Type 2 errors, where choosing a lower significance increases the likelihood of failing to reject the null hypothesis when it is false.\n:::\n\n### Hypotheses\nWhat are the null hypothesis and alternative hypotheses? \n\n<details>\n<summary>Click here to view answer</summary>\n- H~0~: There is no significant difference between the observed and the expected proportions of flower colours.  \n- H~1~: There is a significant difference between the observed and the expected proportions of flower colours.    \n</details>\n\n### Assumptions\n\nRecall that the assumptions of the $\\chi^2$ test are:\n\n1. No cell has expected frequencies less than 1\n2. No more than 20% of cells have expected frequencies less than 5\n\n::: callout-note\nIn the case that the above assumptions are violated then the probability of a type 1 error occurring (rejecting the null hypothesis when it is true, i.e. false positive) increases.\n:::\n\nTo calculate expected frequencies, we first calculate the total number of tulips and then divide by the number of categories.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nexpected <- rep(sum(tulip) * 1 / 3, 3)\nexpected\n```\n:::\n\n\n\n\nDoes the data satisfy the assumptions of a $\\chi^2$ test? \n\n<details>\n<summary>Click here to view answer</summary>\nYes, as expected frequencies > 5.  \n</details>\n\n\n### Test statistic\n\n\nThe ```chisq.test()``` function in R is used  to calculate the chi-squared test.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nres <- chisq.test(tulip, p = c(1 / 3, 1 / 3, 1 / 3))\nres\n```\n:::\n\n\n\n\nNote that we coud check our assumptions post-analysis by checking the expected frequencies stored in the `expected` object of the output:\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nres$expected\n```\n:::\n\n\n\n\n\n### P-value\n\nWrite down how you should report the critical value, p-value and df in a scientific paper?  \n\n<details>\n<summary>Click here to view answer</summary>\n$\\chi^2 = 27.9, d.f. =2, p < 0.01$\n</details>\n\n\n### Conclusions\n\nBased on the p-value, do we accept or reject the null hypothesis?  \n\n\n<details>\n<summary>Click here to view answer</summary>\nWe reject the null hypothesis as the p-value is less than 0.05.\n</details>\n\n\nNow write a scientific (biological) conclusion based on the outcome.\n\n<details>\n<summary>Click here to view answer</summary>\nThere is a significant difference in the proportion of flower colours of tulips ($\\chi^2 = 27.9, d.f. =2, p < 0.01$).  \n</details>\n\n\n\n## Exercise 2: hermit crabs\n### Background\n\nIn a study of hermit crab behaviour at Point Lookout, North Stradbroke Island, a random sample of 3 types of gastropod shells was collected. Each shell was then scored as being either occupied by a hermit crab or empty. Do hermit crabs prefer a certain shell?\n\n|Shell species | Occupied| Empty|\n|--------------|---------|------|\n|Austrochochlea|       47|    42|\n|Bembicium     |       10|    41|\n|Cirithid      |      125|    49|\n\nThe data is stored in a `table` object in R below. Note that it is different from a `data.frame` object. You can verify this by using the `str()` or `class()` functions.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncrabs <- as.table(\n  rbind(\n    Aus = c(47, 42),\n    Bem = c(10, 41),\n    Cir = c(125, 49)\n  )\n)\n\ncolnames(crabs) <- c(\"Occupied\", \"Empty\")\nstr(crabs)\ncrabs\n```\n:::\n\n\n\n\n\n#### Data exploration\n\nSince we have a multi-dimensional dataset, we can try to plot the data to visualise it.\n\nA mosaic plot is a graphical representation of the data in a two-way contingency table. It is a way of visualising the relationship between two categorical variables.\n\nTry the code below. Can you interpret the plot?\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# mosaic plot of crabs\nmosaicplot(crabs, main = \"Hermit crabs and shell species\")\n```\n:::\n\n\n\n\n<details>\n<summary>Click here to view interpretation</summary>\nThe plot shows that the distribution of hermit crabs in the different shell species is not equal. The majority of hermit crabs are found in the *Cirithid* shell species, followed by *Austrochochlea* and *Bembicium*. This can be observed by the **width** of the boxes in the plot.\n\nThere are also differences in the number of empty shells in the different shell species. The *Bembicium* shell species has the highest number of empty shells, followed by *Austrochochlea* and *Cirithid*. This can be observed by the **height** of the boxes in the plot.\n\n</details>\n\n\n### HATPC\n\nNow it is your turn to test the hypothesis that the three shell species are equally preferred by hermit crabs. Follow the HATPC process with the following questions in mind (but you don't have to answer them individually):\n\n1. What are the null hypothesis and alternative hypotheses?\n2. Does the data satisfy the assumptions of a $\\chi^2$ test?\n3. How should you report the critical value, p-value and df in a scientific paper?\n4. Based on the p-value, do we accept or reject the null hypothesis?\n5. Write a scientific (biological) conclusion based on the outcome.\n\nUse the markdown structure below to answer the questions (if you wish):\n\n```md\n## Exercise 2: hermit crabs\n### Hypothesis\n### Assumptions\n### Test statistic\n### P-value\n### Conclusions\n\n```\n\nTake your time, and when you are ready, check your answers with your demonstrators.\n\n\n\n::: {.content-visible when-profile=\"solution\"}\n## Answer to Exercise 2 {style=\"color:green;\"}\n\n### Hypothesis {style=\"color:green;\"}\n\n**H~0~**: There is no significant difference between the observed and the expected use of different shell species by hermit crabs.  \n\n**H~1~**: There is a significant difference between the observed and the expected use of different shell species by hermit crabs.   \n\n### Assumptions {style=\"color:green;\"}\n\nTo check whether the expected frequencies are greater than 5, we can either perform the calculation manually or check the output of the `chisq.test()` function.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nfit <- chisq.test(crabs)\nfit$expected\n```\n:::\n\n\n\n\nFrom the output, we can see that all expected frequencies are greater than 5. The other assumption where no cell has expected frequencies less than 1 is also satisfied.\n\n### Test statistic\n\nIf you have not already done so, perform the chi-squared test using the `chisq.test()` function in R.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nfit <- chisq.test(crabs)\nfit\n```\n:::\n\n\n\n\nWe reject the null hypothesis as the p-value is less than 0.05 and conclude that there is a significant difference between the observed and the expected use of different shell species by hermit crabs ($\\chi^2 = 45.5, d.f. = 2, p < 0.01$).\n:::\n\n## Done!\n\nThis is the end of the lab. Remember to save your work, render your document and ask your demonstrators for feedback if you are unsure about your answers.\n\n",
    "supporting": [
      "Lab07_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}